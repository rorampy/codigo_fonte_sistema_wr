{% extends 'sistema_hash/estrutura/base.html' %}
{% block conteudo %}
{% include 'sistema_hash/estrutura/header.html' %}

<link href="{{ url_for('static', filename='css/financeiro/lancamento/listagem_lancamentos.css') }}" rel="stylesheet">

<div class="page-wrapper">
  <div class="page-header d-print-none">
    <div class="container-xl">
      <div class="row g-2 align-items-center">
        <div class="col">
          <div class="page-pretitle">GERENCIAMENTO FINANCEIRO</div>
          <h2 class="page-title">Meus lan√ßamentos</h2>
        </div>
        <div class="col-12 col-md-auto ms-auto d-print-none">
          <div class="d-flex gap-2">
            <a href="{{url_for('cadastrar_lancamento')}}" class="btn btn-primary">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                class="icon icon-tabler icons-tabler-outline icon-tabler-plus">
                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                <path d="M12 5l0 14" />
                <path d="M5 12l14 0" />
              </svg>
              Novo Lan√ßamento
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="page-body">
    <div class="container-xl">
      {% include 'sistema_hash/estrutura/mensagens_flash.html' %}

      {%if lancamentos%}
      <!-- Tabela de Lan√ßamentos -->
      <div class="lancamentos-section">
        <div class="table-header">
          <h3 class="table-title">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="20" height="20" viewBox="0 0 24 24"
              stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
              <path stroke="none" d="M0 0h24v24H0z" fill="none" />
              <path d="M9 11l3 3l8 -8" />
              <path d="M20 12v6a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h9" />
            </svg>
            Lan√ßamentos Recentes
          </h3>
        </div>

        <div class="lancamentos-list">
          {% for lanc in lancamentos %}
          <div class="lancamento-item">
            <div class="lancamento-icon {{ 'receita' if lanc.tipo_lancamento == 1 else 'despesa' }}">
              {% if lanc.tipo_lancamento == 1 %}
              <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="20" height="20" viewBox="0 0 24 24"
                stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                <path d="M3 17l6 -6l4 4l8 -8" />
                <path d="M14 7l7 0l0 7" />
              </svg>
              {% else %}
              <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="20" height="20" viewBox="0 0 24 24"
                stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                <path d="M3 7l6 6l4 -4l8 8" />
                <path d="M21 10l0 7l-7 0" />
              </svg>
              {% endif %}
            </div>

            <div class="lancamento-details">
              <div class="lancamento-title">{{ lanc.descricao }}</div>
              <div class="lancamento-subtitle">
                <span class="lancamento-category">
                  {% if lanc.categoria %}
                  {{ lanc.categoria.codigo }} - {{ lanc.categoria.nome }}
                  {% else %}
                  Categoria n√£o definida
                  {% endif %}
                </span>
                <span>‚Ä¢</span>
                <span>
                  {{ 'Movimenta√ß√£o Recorrente' if lanc.despesa_recorrente else
                  'Pagamento √önico' }}
                </span>
              </div>
            </div>

            <div class="lancamento-amount">
              <div class="amount-value {{ 'positive' if lanc.tipo_lancamento == 1 else 'negative' }}">
                {{ '+' if lanc.tipo_lancamento == 1 else '-' }}
                {{ lanc.valor_lancamento_100 | formatar_float_para_brl }}
              </div>
              <div class="amount-date">
                {%if lanc.despesa_recorrente == false %}
                {{ lanc.data_movimentacao | formatar_data_para_brl }}
                {%else%}
                Dia movimenta√ß√£o: {{ lanc.dia_movimentacao }}
                {%endif%}
              </div>
            </div>

            <!-- Bot√µes de A√ß√£o Desktop -->
            <div class="lancamento-actions">
              <a href="{%if lanc.despesa_recorrente%}{{url_for('editar_despesa_recorrente', id=lanc.id)}}{%else%}{{url_for('editar_lancamento', id=lanc.id)}}{%endif%}"
                class="btn btn-icon btn-outline-orange" data-bs-toggle="tooltip" data-bs-placement="top"
                title="Editar lan√ßamento">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                  stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                  <path d="M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                </svg>
              </a>

              <a href="#" class="btn btn-icon btn-outline-danger" data-bs-toggle="modal"
                data-bs-target="#modal-excluir-{{ lanc.id }}">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                  stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="3,6 5,6 21,6"></polyline>
                  <path d="M19,6V20a2,2,0,0,1-2,2H7a2,2,0,0,1-2-2V6m3,0V4a2,2,0,0,1,2-2h4a2,2,0,0,1,2,2V6"></path>
                  <line x1="10" y1="11" x2="10" y2="17"></line>
                  <line x1="14" y1="11" x2="14" y2="17"></line>
                </svg>
              </a>
              <div class="modal modal-blur fade" id="modal-excluir-{{lanc.id}}" tabindex="-1" role="dialog"
                aria-hidden="true">
                <div class="modal-dialog modal-sm modal-dialog-centered" role="document">
                  <div class="modal-content">
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    <div class="modal-status bg-danger"></div>
                    <div class="modal-body text-center py-4">
                      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="icon mb-2 text-danger icon-lg">
                        <path d="M12 9v4" />
                        <path
                          d="M10.363 3.591l-8.106 13.534a1.914 1.914 0 0 0 1.636 2.871h16.214a1.914 1.914 0 0 0 1.636 -2.87l-8.106 -13.536a1.914 1.914 0 0 0 -3.274 0z" />
                        <path d="M12 16h.01" />
                      </svg>
                      <div class="text-secondary">
                        Voc√™ realmente deseja excluir este lan√ßamento?
                      </div>
                    </div>
                    <div class="modal-footer">
                      <div class="w-100">
                        <div class="row">
                          <div class="col">
                            <a href="#" class="btn btn-3 w-100" data-bs-dismiss="modal">
                              Fechar
                            </a>
                          </div>
                          <div class="col">
                            <a href="{{url_for('excluir_lancamento', id=lanc.id)}}" class="btn btn-danger btn-4 w-100">
                              Sim
                            </a>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
      {%else%}
      <div class="area-info" style="
        padding: 30px;
        border-radius: 10px;
        text-align: center;
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.04);
        background-color:#ffffff
      ">
        <div class="icon-info" style="font-size: 60px; color: #fc7801; margin-bottom: 15px">
          üìÑ
        </div>
        <h2 style="font-size: 22px; margin-bottom: 10px">
          Nenhum lan√ßamento encontrado
        </h2>
        <p>
          N√£o encontramos lan√ßamentos para serem exibidos no
          momento.
        </p>
      </div>
      {%endif%}

    </div>
  </div>

  {% include 'sistema_hash/estrutura/footer.html' %}
</div>

{% endblock conteudo %}