{% extends 'sistema_wr/estrutura/base.html' %}
{% block conteudo %}
{% include 'sistema_wr/estrutura/header.html' %}
<div class="page-wrapper">
  <div class="page-header d-print-none">
    <div class="container-xl">
      <div class="row g-2 align-items-center">
        <div class="col">
          <div class="page-pretitle">FINANCEIRO</div>
          <h2 class="page-title">Lançamentos a Receber</h2>
        </div>
        <!-- <div class="col-12 col-md-auto ms-auto d-print-none">
          <div class="d-flex gap-2">
            <a href="#" class="btn" data-bs-toggle="modal" data-bs-target="#modal-report">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                class="icon icon-tabler icons-tabler-outline icon-tabler-filter">
                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                <path
                  d="M4 4h16v2.172a2 2 0 0 1 -.586 1.414l-4.414 4.414v7l-6 2v-8.5l-4.48 -4.928a2 2 0 0 1 -.52 -1.345v-2.227z" />
              </svg>
              Filtrar
            </a>
          </div>
        </div> -->
      </div>
    </div>
  </div>

  <div class="page-body">
    <div class="container-xl">
      {% include 'sistema_wr/estrutura/mensagens_flash.html' %}
      <div class="col-12">
        <div class="card" id="registrosRecebimento">
          <div class="card-body p-0">
            {% if recebimento %}
            <div class="accordion" id="clientesAccordion">
              {% for cliente, dados in recebimento.items() %}
              {% set cliente_id = loop.index %}
              <div class="accordion-item">
                <h2 class="accordion-header" id="heading-cliente-{{ cliente_id }}">
                  <button class="accordion-button" type="button" data-bs-toggle="collapse"
                    data-bs-target="#collapse-cliente-{{ cliente_id }}" aria-expanded="true">
                    <div class="d-flex align-items-center justify-content-between w-100 me-3">
                      <div>
                        <strong>{{ cliente }}</strong>
                      </div>
                    </div>
                  </button>
                </h2>
                <div id="collapse-cliente-{{ cliente_id }}"
                  class="accordion-collapse collapse {% if loop.first %}show{% endif %}"
                  data-bs-parent="#clientesAccordion">
                  <div class="accordion-body p-0">
                    <div class="cliente-section border-bottom">
                      <div class="p-3">
                        <div class="table-responsive">
                          <table class="table table-vcenter table-hover table-striped">
                            <thead class="bg-light">
                              <tr>
                                <th class="text-center">Data Vencimento</th>
                                <th class="text-center">Cliente</th>
                                <th class="text-center">Produto</th>
                                <th class="text-center">Status Financeiro</th>
                                <th class="text-center">Valor a Receber</th>
                                <th class="text-center">Valor Recebido</th>
                                <th class="text-center">Data Pagamento</th>
                                <th class="text-center">Ações</th>
                              </tr>
                            </thead>
                            <tbody>
                              {% for receb in dados.recebimentos %}
                              <tr>
                                <td class="text-center">
                                  {{ receb.data_vencimento | formatar_data_para_brl or '-' }}
                                </td>
                                <td class="text-center">
                                  {% if receb.contrato %}
                                  {{ receb.contrato.cliente.identificacao |
                                  truncate(25, True, '...') if
                                  receb.contrato.cliente else '-' }}
                                  {% else %}-{% endif %}
                                </td>
                                <td class="text-center">
                                  {% if receb.contrato_produto %}
                                  {{ receb.contrato_produto.produto.descricao |
                                  truncate(20, True, '...') if
                                  receb.contrato_produto.produto else '-' }}
                                  {% else %}-{% endif %}
                                </td>
                                <td class="text-center">
                                  {% if receb.status %}
                                  {% set nome = receb.status.descricao|lower %}
                                  {% if nome in ['pago', 'recebido'] %}
                                  <span class="badge badge-outline text-green">{{ receb.status.descricao }}</span>
                                  {% elif nome in ['cancelado', 'estornado'] %}
                                  <span class="badge badge-outline text-gray">{{ receb.status.descricao }}</span>
                                  {% elif nome in ['aguardando pagamento'] %}
                                  <span class="badge badge-outline text-orange">{{ receb.status.descricao }}</span>
                                  {% elif nome in ['pagamento atrasado'] %}
                                  <span class="badge badge-outline text-red">{{ receb.status.descricao }}</span>
                                  {% else %}
                                  <span class="badge badge-outline text-gray">{{ receb.status.descricao }}</span>
                                  {% endif %}
                                  {% else %}
                                  <span class="badge badge-outline text-gray">Sem status</span>
                                  {% endif %}
                                </td>
                                <td class="text-center">
                                  {{ receb.valor_a_receber | formatar_float_para_brl}}
                                </td>
                                <td class="text-center">
                                  {% if receb.status_id == 2 %}
                                  {{ receb.valor_pago | formatar_float_para_brl }}
                                  {% else %}
                                  <span class="text-muted">-</span>
                                  {% endif %}
                                </td>
                                <td class="text-center">
                                  {% if receb.data_pagamento %}
                                  {{ receb.data_pagamento | formatar_data_para_brl
                                  or '-' }}
                                  {% else %}
                                  -
                                  {% endif %}
                                </td>
                                <td>
                                  <div class="btn-list flex-nowrap justify-content-center">
                                    {%if receb.comprovante_id%}
                                    <a href="#" class="btn btn-icon btn-outline-primary btn-visualizar-arquivo"
                                      data-url="{{ url_for('diretorio_upload_comprovante_recebimento',
                                    filename=receb.comprovante.caminho.split('/')[-1]) }}" data-bs-toggle="modal"
                                      data-bs-target="#modal-visualizar-arquivo">
                                      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round"
                                        class="icon icon-tabler icons-tabler-outline icon-tabler-receipt">
                                        <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                                        <path
                                          d="M5 21v-16a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v16l-3 -2l-2 2l-2 -2l-2 2l-2 -2l-3 2m4 -14h6m-6 4h6m-2 4h2" />
                                      </svg>
                                    </a>
                                    {%endif%}
                                    {% if not receb.status_id != 5 %}
                                    <a href="{{url_for('informar_recebimento', id=receb.id)}}"
                                      class="btn btn-icon btn-outline-success" data-bs-toggle="tooltip"
                                      data-bs-placement="top" title="Informar recebimento">
                                      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round" class="icon icon-tabler icon-tabler-cash">
                                        <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                                        <path
                                          d="M7 9m0 2a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v6a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2z" />
                                        <path d="M14 14m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" />
                                        <path d="M17 9v-2a2 2 0 0 0 -2 -2h-10a2 2 0 0 0 -2 2v6a2 2 0 0 0 2 2h2" />
                                      </svg>
                                    </a>
                                    {% else %}
                                    <a href="#" class="btn btn-icon btn-outline-danger" data-bs-toggle="modal"
                                      data-bs-target="#modal-cancelar-{{ receb.id }}">
                                      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round" class="icon icon-tabler icon-tabler-x">
                                        <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                                        <path d="M18 6l-12 12" />
                                        <path d="M6 6l12 12" />
                                      </svg>
                                    </a>
                                    {% endif %}
                                    <!-- <a href="#" class="btn btn-icon btn-outline-primary" data-bs-toggle="tooltip"
                                      onclick="editarRecebimento({{ receb.id }}, this); return false;"
                                      data-bs-placement="top" title="Editar">
                                      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round" class="icon icon-tabler icon-tabler-edit">
                                        <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                                        <path d="M7 7h-1a2 2 0 0 0 -2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2 -2v-1" />
                                        <path
                                          d="M20.385 6.585a2.1 2.1 0 0 0 -2.97 -2.97l-8.415 8.385v3h3l8.385 -8.415z" />
                                        <path d="M16 5l3 3" />
                                      </svg>
                                    </a> -->
                                    <!-- {% if receb.observacao %}
                                    <a href="#" class="btn btn-icon btn-outline-info" data-bs-toggle="tooltip"
                                      data-bs-placement="top" title="{{ receb.observacao }}">
                                      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round" class="icon icon-tabler icon-tabler-info-circle">
                                        <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                                        <path d="M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0" />
                                        <path d="M12 9h.01" />
                                        <path d="M11 12h1v4h1" />
                                      </svg>
                                    </a>
                                    {% endif %} -->
                                  </div>
                                </td>
                              </tr>
                              {% endfor %}
                              {% for receb in dados.recebimentos %}
                              <div class="modal modal-blur fade" id="modal-cancelar-{{ receb.id }}" tabindex="-1"
                                role="dialog" aria-hidden="true">
                                <div class="modal-dialog modal-sm modal-dialog-centered" role="document">
                                  <div class="modal-content">
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                      aria-label="Close"></button>
                                    <div class="modal-status bg-danger"></div>
                                    <div class="modal-body text-center py-4">
                                      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round" class="icon mb-2 text-danger icon-lg">
                                        <path d="M12 9v4" />
                                        <path
                                          d="M10.363 3.591l-8.106 13.534a1.914 1.914 0 0 0 1.636 2.871h16.214a1.914 1.914 0 0 0 1.636 -2.87l-8.106 -13.536a1.914 1.914 0 0 0 -3.274 0z" />
                                        <path d="M12 16h.01" />
                                      </svg>
                                      <div class="text-secondary">
                                        Você realmente deseja cancelar este informe de recebimento?
                                      </div>
                                    </div>
                                    <div class="modal-footer">
                                      <div class="w-100">
                                        <div class="row">
                                          <div class="col">
                                            <a href="#" class="btn btn-3 w-100" data-bs-dismiss="modal">
                                              Fechar
                                            </a>
                                          </div>
                                          <div class="col">
                                            <a href="{{url_for('cancelar_informe_recebimento', id=receb.id)}}"
                                              class="btn btn-danger btn-4 w-100">
                                              Sim
                                            </a>
                                          </div>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>
                              {% endfor %}
                            </tbody>
                          </table>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              {% endfor %}
            </div>
            {% else %}
            <div class="area-info-card"
              style="padding: 30px; border-radius: 10px; text-align: center; box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2); background-color: white;">
              <div class="icon-extrato" style="font-size: 70px; color: #fc7801; margin-bottom: 15px">💰
              </div>
              <h2 style="font-size: 22px; margin-bottom: 10px; color: #555;">Nenhum recebimento encontrado
              </h2>
              <p style="color: #777;">No momento não há lançamentos a receber para exibir.</p>
            </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- <div class="modal modal-blur fade" id="modal-report" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
      <form action="{{ url_for('lancamentos_receber') }}" method="GET">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Filtrar Recebimentos</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label">Data Vencimento Início</label>
                <input type="date" name="dataInicio" class="form-control">
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label">Data Vencimento Fim</label>
                <input type="date" name="dataFim" class="form-control">
              </div>
              <div class="col-md-8 mb-3">
                <label class="form-label">Cliente</label>
                <input type="text" name="cliente" class="form-control">
              </div>
              <div class="col-md-4 mb-3">
                <label class="form-label">Status</label>
                <select name="status" class="form-select">
                  <option value="">Todos</option>
                  <option value="pendente">Pendente</option>
                  <option value="recebido">Recebido</option>
                  <option value="vencido">Vencido</option>
                </select>
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label">Contrato</label>
                <input type="text" name="contrato" class="form-control">
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label">Produto</label>
                <input type="text" name="produto" class="form-control">
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <a href="{{ url_for('lancamentos_receber') }}" class="btn btn-link link-secondary">
              Limpar Filtros
            </a>
            <button type="submit" class="btn btn-primary ms-auto">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                class="icon icon-tabler icon-tabler-filter">
                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                <path
                  d="M4 4h16v2.172a2 2 0 0 1 -.586 1.414l-4.414 4.414v7l-6 2v-8.5l-4.48 -4.928a2 2 0 0 1 -.52 -1.345v-2.227z" />
                </svg>
                Filtrar
              </button>
            </div>
          </div>
        </div>
      </form>
    </div>
  </div> -->
  {% include 'sistema_wr/estrutura/footer.html' %}
</div>
{% endblock conteudo %}