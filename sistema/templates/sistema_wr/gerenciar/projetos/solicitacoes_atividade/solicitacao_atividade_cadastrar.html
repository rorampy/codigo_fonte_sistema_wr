{% extends 'sistema_wr/estrutura/base.html' %}
{% block conteudo %}
{% include 'sistema_wr/estrutura/header.html' %}

<link rel="stylesheet" href="{{ url_for('static', filename='css/atividade_solicitacao/atividade_cadastrar.css') }}">

<div class="page-wrapper">
  <!-- Page header -->
  <div class="page-header d-print-none">
    <div class="container-xl">
      <div class="row g-2 align-items-center">
        <div class="col">
          <div class="page-pretitle">SOLICITAÇÃO</div>
          <h2 class="page-title">Nova Solicitação de Atividade</h2>
        </div>
      </div>
    </div>
  </div>

  <!-- Page body -->
  <div class="page-body">
    <div class="container-xl">
      {% include 'sistema_wr/estrutura/mensagens_flash.html' %}

      <div class="col-12 page-solicitacao">
        <form class="card" method="POST" enctype="multipart/form-data">
          <div class="card-body">

            <!-- Informações da Solicitação -->
            <div class="section-title">
              <svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M14 3v4a1 1 0 0 0 1 1h4" />
                <path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z" />
                <path d="M9 17h6" />
                <path d="M9 13h6" />
              </svg>
              <h3 class="text-primary">Informações da Solicitação</h3>
            </div>

            <div class="row">
              <div class="col-md-12">
                <div class="row">
                  <!-- Projeto -->
                  <div class="col-md-6 mb-3">
                    <label class="form-label required">Projeto</label>
                    <select class="form-select {% if 'projetoId' in campos_obrigatorios %}is-invalid{% endif %}"
                      name="projetoId" required>
                      <option value="">Selecione um projeto</option>
                      {% for projeto in projetos %}
                      <option value="{{ projeto.id }}" {% if (dados_corretos.projetoId==projeto.id|string) or
                        (projeto_id_url==projeto.id) %}selected{% endif %}>
                        {{ projeto.nome_projeto }}
                      </option>
                      {% endfor %}
                    </select>
                    {% if 'projetoId' in campos_obrigatorios %}
                    <div class="invalid-feedback">{{ campos_obrigatorios.get('projetoId') }}</div>
                    {% endif %}
                    {% if 'projetoId' in campos_erros %}
                    <div class="invalid-feedback d-block">{{ campos_erros.get('projetoId') }}</div>
                    {% endif %}
                  </div>


                  <!-- Categoria (Opcional) -->
                  <div class="col-md-3 mb-3">
                    <label class="form-label">Categoria</label>
                    <select class="form-select" name="categoriaId">
                      <option value="">Nenhuma categoria</option>
                      {% for categoria in categorias %}
                      <option value="{{ categoria.id }}" {% if dados_corretos.get('categoriaId')==categoria.id|string
                        %}selected{% endif %}>
                        {{ categoria.nome }}
                      </option>
                      {% endfor %}
                    </select>
                    <small class="form-hint">Classifique sua solicitação para facilitar a organização (opcional)</small>
                  </div>


                  <!-- Area (Opcional) -->
                  <div class="col-md-3 mb-3">
                    <label class="form-label">Área</label>
                    <select class="form-select" name="areaId">
                      <option value="">Nenhuma área</option>
                      {% for area in areas %}
                      <option value="{{ area.id }}" {% if dados_corretos.get('areaId')==area.id|string %}selected{%
                        endif %}>
                        {{ area.nome }}
                      </option>
                      {% endfor %}
                    </select>
                    <small class="form-hint">Defina a área da sua solicitação para melhor organização (opcional)</small>
                  </div>

                </div>



                <!-- Título -->
                <div class="mb-3">
                  <label class="form-label required">Título da Solicitação</label>
                  <input type="text" id="inputTitulo"
                    class="form-control {% if 'titulo' in campos_obrigatorios or 'titulo' in campos_erros %}is-invalid{% endif %}"
                    name="titulo" placeholder="Ex: Implementar relatório de visualização..."
                    value="{{ dados_corretos.get('titulo', '') }}" maxlength="100">

                  <div class="invalid-feedback">
                    {% if 'titulo' in campos_obrigatorios %}
                    {{ campos_obrigatorios['titulo'] }}
                    {% elif 'titulo' in campos_erros %}
                    {{ campos_erros['titulo'] }}
                    {% endif %}
                  </div>

                  <small class="form-hint ms-1">Seja claro e específico sobre o que precisa ser desenvolvido.</small>

                  <div class="char-counter form-hint">
                    <span id="charCountTitulo" class="ms-2">0</span>
                    <span>/ 100</span>
                  </div>
                </div>

                <!-- Descrição -->
                <div class=" mb-3">
                  <label class="form-label">Descrição Detalhada
                    <a href="#" class="btn-guia-solicitacao" data-bs-toggle="modal"
                      data-bs-target="#modal-guia-solicitacao"
                      data-tooltip="Clique para ver dicas de como criar uma boa solicitação">
                      <span class="pulse-ring"></span>
                      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="icon icon-tabler icons-tabler-outline icon-tabler-info-circle">
                        <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                        <path d="M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0" />
                        <path d="M12 9h.01" />
                        <path d="M11 12h1v4h1" />
                      </svg>
                    </a>
                  </label>

                  <!-- Textarea oculto para envio -->
                  <textarea id="descricao" name="descricao"
                    style="display:none;">{{ dados_corretos.descricao or '' }}</textarea>

                  <!-- Editor Quill -->
                  <div id="editor-descricao" style="height: 300px; background: white;"></div>

                  <small class="form-hint">
                    Quanto mais detalhes você fornecer, melhor será a análise da sua solicitação.
                  </small>
                </div>

                <!-- Anexos -->
                <div class="mb-3">
                  <label class="form-label">Anexos (Opcional)</label>
                  <input type="file" class="form-control {% if 'anexos' in campos_erros %}is-invalid{% endif %}"
                    name="anexos[]" multiple accept=".pdf,.doc,.docx,.xls,.xlsx,.png,.jpg,.jpeg,.gif,.txt,.zip,.rar">
                  <small class="form-hint">
                    Tipos permitidos: PDF, DOC, DOCX, XLS, XLSX, PNG, JPG, JPEG, GIF, TXT, ZIP, RAR.
                    Máximo 10MB por arquivo.
                  </small>
                  {% if 'anexos' in campos_erros %}
                  <div class="invalid-feedback d-block">{{ campos_erros.get('anexos') }}</div>
                  {% endif %}
                </div>

                <!-- Preview dos arquivos selecionados -->
                <div id="preview-anexos" class="mt-3" style="display: none;">
                  <h6>Arquivos selecionados:</h6>
                  <div id="lista-anexos" class="list-group"></div>
                </div>
              </div>
            </div>

            <!-- Timeline do Processo -->
            <div class="row mt-4">
              <div class="col-md-12">
                <div class="process-timeline">
                  <div class="process-timeline-title">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                      stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0" />
                      <path d="M12 9h.01" />
                      <path d="M11 12h1v4h1" />
                    </svg>
                    Como funciona o processo
                  </div>
                  <div class="process-timeline-steps">
                    <div class="process-step">
                      <span class="process-step-number">1</span>
                      <div class="process-step-content">
                        <strong>Solicitação</strong>
                        Você cria com os detalhes do que precisa
                      </div>
                    </div>
                    <div class="process-step">
                      <span class="process-step-number">2</span>
                      <div class="process-step-content">
                        <strong>Análise</strong>
                        A gestão analisa e pode solicitar ajustes
                      </div>
                    </div>
                    <div class="process-step">
                      <span class="process-step-number">3</span>
                      <div class="process-step-content">
                        <strong>Aprovação</strong>
                        Vira uma atividade oficial do sistema
                      </div>
                    </div>
                    <div class="process-step">
                      <span class="process-step-number">4</span>
                      <div class="process-step-content">
                        <strong>Desenvolvimento</strong>
                        Entra no fluxo normal de trabalho
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

          </div>

          <div class="card-footer text-center text-md-end">
            <a href="{{ url_for('solicitacoes_atividade_listar') }}" class="btn btn-secondary">
              <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-arrow-left" width="24"
                height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                stroke-linecap="round" stroke-linejoin="round">
                <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                <path d="M5 12l14 0"></path>
                <path d="M5 12l6 6"></path>
                <path d="M5 12l6 -6"></path>
              </svg>
              Cancelar
            </a>
            <button type="submit" class="btn btn-primary">
              <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24"
                stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                <path d="M12 5l0 14" />
                <path d="M5 12l14 0" />
              </svg>
              Enviar Solicitação
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  {% include 'sistema_wr/estrutura/footer.html' %}
</div>

<!--Quill CSS-->
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css" rel="stylesheet">

<!-- Quill JS -->
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>



<script>
  document.addEventListener('DOMContentLoaded', function () {
    // ========================================
    // Configurar highlight.js para Quill
    // ========================================
    hljs.configure({
      languages: ['javascript', 'python', 'html', 'css', 'sql', 'php', 'java']
    });

    // ========================================
    // Inicialização do Quill Editor para Descrição
    // ========================================
    var quillDescricao = new Quill('#editor-descricao', {
      theme: 'snow',
      placeholder: 'Descreva detalhadamente a funcionalidade ou tarefa que você está solicitando:\n\n• Qual problema isso resolve?\n• Como deve funcionar?\n• Há algum requisito específico?\n• Existem exemplos ou referências?',
      modules: {
        toolbar: [
          [{ 'header': [1, 2, 3, false] }],
          ['bold', 'italic', 'underline', 'strike'],
          ['blockquote', 'code-block'],
          [{ 'list': 'ordered' }, { 'list': 'bullet' }],
          [{ 'indent': '-1' }, { 'indent': '+1' }],
          [{ 'color': [] }, { 'background': [] }],
          [{ 'align': [] }],
          ['link'],
          ['clean']
        ],
        syntax: {
          highlight: text => hljs.highlightAuto(text).value
        }
      }
    });

    // Carregar conteúdo inicial (se houver)
    var textareaDescricao = document.getElementById('descricao');
    var conteudoInicial = textareaDescricao ? textareaDescricao.value : '';

    if (conteudoInicial && conteudoInicial.trim() !== '') {
      quillDescricao.root.innerHTML = conteudoInicial;
    }

    // Sincronizar conteúdo do Quill com textarea em tempo real
    quillDescricao.on('text-change', function () {
      var conteudoHtml = quillDescricao.root.innerHTML;

      // Limpar se estiver vazio (apenas tags vazias)
      if (conteudoHtml === '<p><br></p>' || conteudoHtml.trim() === '') {
        conteudoHtml = '';
      }

      document.getElementById('descricao').value = conteudoHtml;
    });

    // Também sincronizar no submit para garantir
    var formCadastro = document.querySelector('form');
    if (formCadastro) {
      formCadastro.addEventListener('submit', function (e) {
        var conteudoHtml = quillDescricao.root.innerHTML;

        // Limpar se estiver vazio (apenas tags vazias)
        if (conteudoHtml === '<p><br></p>' || conteudoHtml.trim() === '') {
          conteudoHtml = '';
        }

        // Sincronizar com textarea
        document.getElementById('descricao').value = conteudoHtml;

        // Debug: verificar se está sendo sincronizado
        console.log('Descrição enviada:', document.getElementById('descricao').value);
      });
    }

    // // Handler para upload de imagem no Quill
    // quillDescricao.getModule('toolbar').addHandler('image', function () {
    //   var input = document.createElement('input');
    //   input.setAttribute('type', 'file');
    //   input.setAttribute('accept', 'image/*');
    //   input.click();

    //   input.onchange = function () {
    //     var file = input.files[0];
    //     if (/^image\//.test(file.type)) {
    //       var reader = new FileReader();
    //       reader.onload = function (e) {
    //         var range = quillDescricao.getSelection();
    //         quillDescricao.insertEmbed(range.index, 'image', e.target.result);
    //       };
    //       reader.readAsDataURL(file);
    //     } else {
    //       alert('Por favor, selecione apenas imagens.');
    //     }
    //   };
    // });

    // ========================================
    // Efeito shake e contador de caracteres para o Titulo
    // ========================================
    const inputTitulo = document.getElementById('inputTitulo');
    const charCountTitulo = document.getElementById('charCountTitulo');
    const counterTitulo = inputTitulo?.closest('.mb-3')?.querySelector('.char-counter');
    const maxLength = 100;

    // Valida se existe os elementos antes de adicionar o evento
    if (inputTitulo && charCountTitulo && counterTitulo) {
      // Função que verifica e atualiza o contador de caracteres de forma dinamica
      function updateCounter() {
        const length = inputTitulo.value.length;
        charCountTitulo.textContent = length;

        // Muda a cor direto no estilo
        if (length >= maxLength) {
          counterTitulo.style.color = '#d63939';
          counterTitulo.style.fontWeight = '600';
        } else if (length >= maxLength * 0.9) {
          counterTitulo.style.color = '#f76707';
          counterTitulo.style.fontWeight = '600';
        } else {
          counterTitulo.style.color = 'black';
          counterTitulo.style.fontWeight = 'normal';
        }
      }

      // Função que realiza o feedback visual de shake no input 

      function shakeInput() {
        inputTitulo.style.transition = 'transform 0.1s ease-in-out, border-color 0.3s';
        inputTitulo.style.borderColor = '#d63939';

        const positions = [-8, 8, -6, 6, -4, 4, -2, 2, 0];
        let index = 0;

        const interval = setInterval(() => {
          if (index < positions.length) {
            inputTitulo.style.transform = `translateX(${positions[index]}px)`;
            index++;
          } else {
            clearInterval(interval);
            inputTitulo.style.transform = 'translateX(0)';
            inputTitulo.style.borderColor = '';
            inputTitulo.style.transition = '';
          }
        }, 70);
      }

      inputTitulo.addEventListener('input', updateCounter);

      inputTitulo.addEventListener('keydown', (e) => {
        const length = inputTitulo.value.length;
        if (length >= maxLength) {
          const allowedKeys = ['Backspace', 'Delete', 'ArrowLeft', 'ArrowRight', 'Tab', 'CapsLock', 'F5', 'Home', 'End'];
          if (!allowedKeys.includes(e.key) && !e.ctrlKey && !e.metaKey) {
            e.preventDefault();
            shakeInput();
          }
        }
      });
    }



    // Preview de anexos
    const inputAnexos = document.querySelector('input[name="anexos[]"]');
    const previewAnexos = document.getElementById('preview-anexos');
    const listaAnexos = document.getElementById('lista-anexos');

    if (inputAnexos) {
      inputAnexos.addEventListener('change', function () {
        const files = this.files;
        listaAnexos.innerHTML = '';

        if (files.length > 0) {
          previewAnexos.style.display = 'block';

          Array.from(files).forEach((file, index) => {
            const item = document.createElement('div');
            item.className = 'list-group-item d-flex justify-content-between align-items-center';

            const fileSize = (file.size / 1024 / 1024).toFixed(2);
            const fileIcon = getFileIcon(file.name);

            item.innerHTML = `
                        <div class="d-flex align-items-center">
                            <span class="me-2">${fileIcon}</span>
                            <div>
                                <div class="font-weight-medium">${file.name}</div>
                                <small class="text-secondary">${fileSize} MB</small>
                            </div>
                        </div>
                        <span class="badge bg-primary">${index + 1}</span>
                    `;

            listaAnexos.appendChild(item);
          });
        } else {
          previewAnexos.style.display = 'none';
        }
      });
    }

    function getFileIcon(filename) {
      const ext = filename.split('.').pop().toLowerCase();

      // Ícones Tabler outline para cada tipo de arquivo
      const iconSvgs = {
        'pdf': '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-danger"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14 3v4a1 1 0 0 0 1 1h4" /><path d="M5 12v-7a2 2 0 0 1 2 -2h7l5 5v4" /><path d="M5 18h1.5a1.5 1.5 0 0 0 0 -3h-1.5v6" /><path d="M17 18h2" /><path d="M20 15h-3v6" /><path d="M11 15v6h1a2 2 0 0 0 2 -2v-2a2 2 0 0 0 -2 -2h-1z" /></svg>',
        'doc': '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-primary"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14 3v4a1 1 0 0 0 1 1h4" /><path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z" /><path d="M9 17h6" /><path d="M9 13h6" /></svg>',
        'docx': '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-primary"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14 3v4a1 1 0 0 0 1 1h4" /><path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z" /><path d="M9 17h6" /><path d="M9 13h6" /></svg>',
        'xls': '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-success"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14 3v4a1 1 0 0 0 1 1h4" /><path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z" /><path d="M10 12h4" /><path d="M10 16h4" /><path d="M8 12v4" /><path d="M16 12v4" /></svg>',
        'xlsx': '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-success"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14 3v4a1 1 0 0 0 1 1h4" /><path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z" /><path d="M10 12h4" /><path d="M10 16h4" /><path d="M8 12v4" /><path d="M16 12v4" /></svg>',
        'png': '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-info"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M15 8h.01" /><path d="M3 6a3 3 0 0 1 3 -3h12a3 3 0 0 1 3 3v12a3 3 0 0 1 -3 3h-12a3 3 0 0 1 -3 -3v-12z" /><path d="M3 16l5 -5c.928 -.893 2.072 -.893 3 0l5 5" /><path d="M14 14l1 -1c.928 -.893 2.072 -.893 3 0l3 3" /></svg>',
        'jpg': '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-info"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M15 8h.01" /><path d="M3 6a3 3 0 0 1 3 -3h12a3 3 0 0 1 3 3v12a3 3 0 0 1 -3 3h-12a3 3 0 0 1 -3 -3v-12z" /><path d="M3 16l5 -5c.928 -.893 2.072 -.893 3 0l5 5" /><path d="M14 14l1 -1c.928 -.893 2.072 -.893 3 0l3 3" /></svg>',
        'jpeg': '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-info"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M15 8h.01" /><path d="M3 6a3 3 0 0 1 3 -3h12a3 3 0 0 1 3 3v12a3 3 0 0 1 -3 3h-12a3 3 0 0 1 -3 -3v-12z" /><path d="M3 16l5 -5c.928 -.893 2.072 -.893 3 0l5 5" /><path d="M14 14l1 -1c.928 -.893 2.072 -.893 3 0l3 3" /></svg>',
        'gif': '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-info"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M15 8h.01" /><path d="M3 6a3 3 0 0 1 3 -3h12a3 3 0 0 1 3 3v12a3 3 0 0 1 -3 3h-12a3 3 0 0 1 -3 -3v-12z" /><path d="M3 16l5 -5c.928 -.893 2.072 -.893 3 0l5 5" /><path d="M14 14l1 -1c.928 -.893 2.072 -.893 3 0l3 3" /></svg>',
        'txt': '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-secondary"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14 3v4a1 1 0 0 0 1 1h4" /><path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z" /><path d="M9 9l1 0" /><path d="M9 13l6 0" /><path d="M9 17l6 0" /></svg>',
        'zip': '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-warning"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 20.735a2 2 0 0 1 -1 -1.735v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2h-1" /><path d="M11 17a2 2 0 0 1 2 2v2a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1v-2a2 2 0 0 1 2 -2z" /><path d="M11 5l0 2" /><path d="M13 7l0 2" /><path d="M11 9l0 2" /><path d="M13 11l0 2" /><path d="M11 13l0 2" /></svg>',
        'rar': '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-warning"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 20.735a2 2 0 0 1 -1 -1.735v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2h-1" /><path d="M11 17a2 2 0 0 1 2 2v2a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1v-2a2 2 0 0 1 2 -2z" /><path d="M11 5l0 2" /><path d="M13 7l0 2" /><path d="M11 9l0 2" /><path d="M13 11l0 2" /><path d="M11 13l0 2" /></svg>'
      };

      // Ícone padrão para arquivos desconhecidos
      const defaultIcon = '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-muted"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14 3v4a1 1 0 0 0 1 1h4" /><path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z" /></svg>';

      return iconSvgs[ext] || defaultIcon;
    }
  });

  // Accordion behavior - abre apenas um item por vez
  function toggleGuideStep(element) {
    const allSteps = document.querySelectorAll('.guide-step');
    const isActive = element.classList.contains('active');

    // Fecha todos os passos
    allSteps.forEach(step => step.classList.remove('active'));

    // Abre o passo clicado (se não estava ativo)
    if (!isActive) {
      element.classList.add('active');
    }
  }
  window.toggleGuideStep = toggleGuideStep;

  // Para a animação pulsante após clicar no botão (apenas na sessão atual)
  const btnGuia = document.querySelector('.btn-guia-solicitacao');
  const pulseRing = document.querySelector('.btn-guia-solicitacao .pulse-ring');

  if (btnGuia && pulseRing) {
    // Para ao clicar
    btnGuia.addEventListener('click', function () {
      pulseRing.classList.add('pulse-stopped');
    });

    // Para automaticamente após 15 segundos
    setTimeout(function () {
      pulseRing.classList.add('pulse-stopped');
    }, 15000);
  }

</script>



<!-- Modal Guia de Solicitação - Branco Moderno -->
<div class="modal modal-blur fade" id="modal-guia-solicitacao" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">
          <span class="icon-title">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"
              class="icon icon-tabler icons-tabler-filled icon-tabler-shield-check">
              <path stroke="none" d="M0 0h24v24H0z" fill="none" />
              <path
                d="M11.998 2l.118 .007l.059 .008l.061 .013l.111 .034a.993 .993 0 0 1 .217 .112l.104 .082l.255 .218a11 11 0 0 0 7.189 2.537l.342 -.01a1 1 0 0 1 1.005 .717a13 13 0 0 1 -9.208 16.25a1 1 0 0 1 -.502 0a13 13 0 0 1 -9.209 -16.25a1 1 0 0 1 1.005 -.717a11 11 0 0 0 7.531 -2.527l.263 -.225l.096 -.075a.993 .993 0 0 1 .217 -.112l.112 -.034a.97 .97 0 0 1 .119 -.021l.115 -.007zm3.71 7.293a1 1 0 0 0 -1.415 0l-3.293 3.292l-1.293 -1.292l-.094 -.083a1 1 0 0 0 -1.32 1.497l2 2l.094 .083a1 1 0 0 0 1.32 -.083l4 -4l.083 -.094a1 1 0 0 0 -.083 -1.32z" />
            </svg>
          </span>
          Como criar uma boa solicitação
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
      </div>
      <div class="modal-body">

        <!-- Passo 1 -->
        <div class="guide-step active">
          <div class="guide-step-header" onclick="toggleGuideStep(this.parentElement)">
            <span class="guide-step-number">1</span>
            <h6 class="guide-step-title">Escreva um título claro e específico</h6>
            <svg class="guide-step-toggle" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
              fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M6 9l6 6l6 -6" />
            </svg>
          </div>
          <div class="guide-step-content">
            <p>O título deve dizer <strong>exatamente o que será feito</strong> e <strong>onde</strong>.</p>

            <div class="example-box good">
              <span class="example-label good">Bons exemplos</span>
              "Adicionar filtro por data no Relatório de Vendas"<br>
              "Corrigir erro ao salvar Atividade sem categoria"<br>
              "Exibir total de horas no topo da tela de Lançamento"
            </div>

            <div class="example-box bad">
              <span class="example-label bad">Evite</span>
              "Melhorar relatório" - "Bug urgente" - "Não funciona"
            </div>

            <div class="tip-inline">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                class="icon icon-tabler icons-tabler-outline icon-tabler-info-circle">
                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                <path d="M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0" />
                <path d="M12 9h.01" />
                <path d="M11 12h1v4h1" />
              </svg>
              <span>Comece com um verbo: <strong>Adicionar / Corrigir / Ajustar / Exibir / Remover / Validar /
                  Bloquear</strong></span>
            </div>
          </div>
        </div>

        <!-- Passo 2 -->
        <div class="guide-step">
          <div class="guide-step-header" onclick="toggleGuideStep(this.parentElement)">
            <span class="guide-step-number">2</span>
            <h6 class="guide-step-title">Informe onde acontece e qual é o objetivo</h6>
            <svg class="guide-step-toggle" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
              fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M6 9l6 6l6 -6" />
            </svg>
          </div>
          <div class="guide-step-content">
            <p>Elimine suposições do time técnico. Inclua:</p>
            <ul>
              <li><strong>Sistema / Módulo / Tela:</strong> onde exatamente é</li>
              <li><strong>Quem usa:</strong> perfil/área (financeiro, operador, admin)</li>
              <li><strong>Objetivo:</strong> o que você precisa conseguir fazer</li>
              <li><strong>Impacto:</strong> atrasa trabalho? bloqueia? é melhoria?</li>
            </ul>

            <div class="example-box neutral">
              <span class="example-label neutral">Exemplo</span>
              "Na tela de Lançamento de Horas, o líder precisa ver o total de horas do período filtrado para validar o
              fechamento do mês. Hoje ele soma manualmente."
            </div>
          </div>
        </div>

        <!-- Passo 3 -->
        <div class="guide-step">
          <div class="guide-step-header" onclick="toggleGuideStep(this.parentElement)">
            <span class="guide-step-number">3</span>
            <h6 class="guide-step-title">Descreva o cenário atual (o que existe hoje)</h6>
            <svg class="guide-step-toggle" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
              fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M6 9l6 6l6 -6" />
            </svg>
          </div>
          <div class="guide-step-content">
            <p>Explique brevemente <strong>como está funcionando hoje</strong> antes de pedir mudanças:</p>

            <div class="example-box neutral">
              <span class="example-label neutral">Exemplo</span>
              "Hoje, ao acessar o Relatório de Vendas, não há opção de filtrar por período. O usuário precisa exportar
              todos os dados e filtrar manualmente no Excel."
            </div>

            <div class="tip-inline">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                class="icon icon-tabler icons-tabler-outline icon-tabler-info-circle">
                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                <path d="M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0" />
                <path d="M12 9h.01" />
                <path d="M11 12h1v4h1" />
              </svg>
              <span>Isso ajuda a classificar: <strong>Bug</strong> (algo quebrado), <strong>Melhoria</strong> (funciona,
                mas poderia ser melhor) ou <strong>Novo recurso</strong>.</span>
            </div>
          </div>
        </div>

        <!-- Passo 4 -->
        <div class="guide-step">
          <div class="guide-step-header" onclick="toggleGuideStep(this.parentElement)">
            <span class="guide-step-number">4</span>
            <h6 class="guide-step-title">Se for erro: explique como replicar</h6>
            <svg class="guide-step-toggle" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
              fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M6 9l6 6l6 -6" />
            </svg>
          </div>
          <div class="guide-step-content">
            <p>Essa é a etapa que <strong>mais acelera correções</strong>. Inclua o passo a passo:</p>
            <ul>
              <li><strong>Acesse:</strong> tela/caminho do menu</li>
              <li><strong>Faça:</strong> ações exatas</li>
              <li><strong>Preencha:</strong> dados usados</li>
              <li><strong>Clique em:</strong> botão/ação</li>
              <li><strong>Resultado atual:</strong> o que acontece</li>
              <li><strong>Resultado esperado:</strong> o que deveria acontecer</li>
              <li><strong>Frequência:</strong> sempre / às vezes / depende de quê?</li>
            </ul>

            <div class="example-box neutral">
              <span class="example-label neutral">Exemplo de como replicar</span>
              1. Ir em "Solicitação de Atividade" → "Nova"<br>
              2. Preencher título e descrição<br>
              3. Deixar categoria em branco<br>
              4. Clicar em "Salvar"<br><br>
              <strong>Atual:</strong> aparece erro 500<br>
              <strong>Esperado:</strong> mostrar "Categoria é obrigatória"<br>
              <strong>Frequência:</strong> sempre
            </div>
          </div>
        </div>

        <!-- Passo 5 -->
        <div class="guide-step">
          <div class="guide-step-header" onclick="toggleGuideStep(this.parentElement)">
            <span class="guide-step-number">5</span>
            <h6 class="guide-step-title">Defina o comportamento esperado (critérios de aceite)</h6>
            <svg class="guide-step-toggle" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
              fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M6 9l6 6l6 -6" />
            </svg>
          </div>
          <div class="guide-step-content">
            <p>Diga como deve ficar "quando estiver pronto". Pense como checklist:</p>
            <ul>
              <li>Quais ações o usuário poderá fazer?</li>
              <li>Qual resultado deve aparecer?</li>
              <li>Quais regras de negócio entram?</li>
              <li>O que <strong>não pode</strong> acontecer?</li>
            </ul>

            <div class="example-box good">
              <span class="example-label good">Exemplo objetivo</span>
              • Deve permitir filtrar por Data Inicial e Data Final<br>
              • Deve atualizar a lista e o resumo de totais<br>
              • Deve manter os filtros atuais (usuário/status)<br>
              • Não deve quebrar exportação/relatório atual
            </div>
          </div>
        </div>

        <!-- Passo 6 -->
        <div class="guide-step">
          <div class="guide-step-header" onclick="toggleGuideStep(this.parentElement)">
            <span class="guide-step-number">6</span>
            <h6 class="guide-step-title">Inclua referências visuais e evidências</h6>
            <svg class="guide-step-toggle" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
              fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M6 9l6 6l6 -6" />
            </svg>
          </div>
          <div class="guide-step-content">
            <p>Isso reduz muito idas e vindas. Inclua:</p>
            <ul>
              <li>Prints de tela (com setas/circulado)</li>
              <li>Vídeo curto (quando for fluxo)</li>
              <li>Exemplo de sistema parecido (link)</li>
              <li>Log/mensagem de erro (se tiver)</li>
            </ul>

            <div class="tip-inline">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                class="icon icon-tabler icons-tabler-outline icon-tabler-info-circle">
                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                <path d="M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0" />
                <path d="M12 9h.01" />
                <path d="M11 12h1v4h1" />
              </svg>
              <span>Marque no print: "Aqui deveria aparecer…" ou "Esse botão deveria…"</span>
            </div>
          </div>
        </div>

        <!-- Passo 7 -->
        <div class="guide-step">
          <div class="guide-step-header" onclick="toggleGuideStep(this.parentElement)">
            <span class="guide-step-number">7</span>
            <h6 class="guide-step-title">Informe restrições e contexto técnico</h6>
            <svg class="guide-step-toggle" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
              fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M6 9l6 6l6 -6" />
            </svg>
          </div>
          <div class="guide-step-content">
            <p>Quando souber, informe:</p>
            <ul>
              <li>Prazo (se realmente for crítico)</li>
              <li>Limitações conhecidas</li>
              <li>Regras específicas do setor</li>
              <li>Dependências (ex.: "depende do cadastro X estar pronto")</li>
            </ul>
          </div>
        </div>

        <!-- Passo 8 -->
        <div class="guide-step">
          <div class="guide-step-header" onclick="toggleGuideStep(this.parentElement)">
            <span class="guide-step-number">8</span>
            <h6 class="guide-step-title">Ajude a priorizar (impacto + urgência)</h6>
            <svg class="guide-step-toggle" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
              fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M6 9l6 6l6 -6" />
            </svg>
          </div>
          <div class="guide-step-content">
            <p>Em vez de "urgente", diga o <strong>porquê</strong>:</p>
            <ul>
              <li><strong>Alta:</strong> bloqueia operação / impede faturamento / erro frequente</li>
              <li><strong>Média:</strong> reduz produtividade / causa retrabalho</li>
              <li><strong>Baixa:</strong> estética / melhoria desejável</li>
            </ul>
            <p>E detalhe: <em>Quantas pessoas são afetadas? Existe workaround (solução temporária)?</em></p>
          </div>
        </div>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary btn-entendi" data-bs-dismiss="modal">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="me-2">
            <path d="M5 12l5 5l10 -10" />
          </svg>
          Entendi!
        </button>
      </div>
    </div>
  </div>
</div>

{% endblock conteudo %}