{% extends 'sistema_wr/estrutura/base.html' %}
{% block conteudo %}
{% include 'sistema_wr/estrutura/header.html' %}

<div class="page-wrapper">

  <!-- HEADER -->
  <div class="page-header d-print-none">
    <div class="container-xl">
      <div class="row g-2 align-items-center">
        <div class="col">
          <div class="page-pretitle">GERENCIAMENTO DE TAGS</div>
          <h2 class="page-title">Cadastrar Nova Tag</h2>
        </div>
      </div>
    </div>
  </div>

  <!-- BODY -->
  <div class="page-body">
    <div class="container-xl">

      {% include 'sistema_wr/estrutura/mensagens_flash.html' %}

      <div class="row justify-content-center">
        <div class="col-lg-12 col-xl-12">

          <form method="POST" action="{{ url_for('tags_cadastrar') }}">
            <div class="card shadow-sm">

              <div class="card-header">
                <h3 class="card-title">Dados da Tag</h3>
              </div>

              <div class="card-body">

                <!-- NOME -->
                <div class="row">
                  <div class="col-4 col-md-6">
                    <div class="mb-3">
                      <label class="form-label required">Nome da Tag</label>
                      <input type="text" name="nome" id="input-nome"
                        class="form-control {% if campos_obrigatorios.nome or campos_erros.nome %}is-invalid{% endif %}"
                        placeholder="Ex: Urgente" maxlength="100">

                      {% if campos_obrigatorios or campos_erros.nome %}
                      <div class="invalid-feedback">
                        O campo nome da tag é obrigatório e deve ser único.
                      </div>
                      {% endif %}

                      <small class="form-hint">Nome único, máximo 100 caracteres.</small>
                    </div>
                  </div>


                  <!-- COR -->
                  <div class="col-4 col-md-6">
                    <div class="mb-3">
                      <label class="form-label required">Cor da Tag</label>
                      <select name="cor" id="select-cor"
                        class="form-select {% if campos_obrigatorios.cor or campos_erros.cor %}is-invalid{% endif %}">
                        <option value="">Selecione uma cor</option>
                        {% for cor in cores_permitidas %}
                        <option value="{{ cor }}">
                          {{ TagModel.obter_nome_cor(cor) }}
                        </option>
                        {% endfor %}
                      </select>
                      {% if campos_obrigatorios or campos_erros.cor %}
                      <div class="invalid-feedback">
                        O campo nome de cor é obrigatório.
                      </div>
                      {% endif %}
                      <small class="form-hint">Define a cor visual da tag.</small>
                    </div>
                  </div>

                </div>
                <!-- DESCRIÇÃO -->
                <div class="mb-4">
                  <label class="form-label">Descrição (Opcional)</label>
                  <textarea name="descricao" class="form-control" rows="3" maxlength="255"
                    placeholder="Descreva quando essa tag deve ser utilizada..."></textarea>
                  <small class="form-hint">Máximo 255 caracteres.</small>
                </div>

                <!-- PREVIEW -->
                <div class="mb-3">
                  <label class="form-label">Pré-visualização</label>
                  <div class="card card-sm bg-light">
                    <div class="card-body text-center">
                      <span id="preview-badge" class="badge badge-outline text-muted px-4 py-2">
                        <span id="preview-nome">Nome da Tag</span>
                      </span>
                    </div>
                  </div>
                </div>

              </div>

              <div class="card-footer d-flex justify-content-between align-items-center">
                <a href="{{ url_for('tags_listar') }}" class="btn btn-link text-muted">
                  Voltar
                </a>

                <button type="submit" class="btn btn-primary">
                  <svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 24 24" stroke-width="2"
                    stroke="currentColor" fill="none">
                    <path d="M5 12l5 5l10 -10" />
                  </svg>
                  Criar Tag
                </button>
              </div>

            </div>
          </form>

        </div>
      </div>
    </div>
  </div>

  {% include 'sistema_wr/estrutura/footer.html' %}
</div>

<!-- SCRIPT PREVIEW -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const nomeInput = document.getElementById('input-nome');
    const corSelect = document.getElementById('select-cor');


    const previewBadge = document.getElementById('preview-badge');
    const previewNome = document.getElementById('preview-nome');


    function atualizarPreview() {
      previewNome.textContent = nomeInput.value || 'Nome da Tag';


      previewBadge.className = 'badge badge-outline px-4 py-2';
      if (corSelect.value) {
        previewBadge.classList.add(corSelect.value);
      } else {
        previewBadge.classList.add('badge-outline', 'text-muted');
      }
    }

    nomeInput.addEventListener('input', atualizarPreview);
    corSelect.addEventListener('change', atualizarPreview);
  });
</script>

{% endblock conteudo %}